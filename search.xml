<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MariaDB / MySQL下使用二进制日志恢复数据</title>
    <url>/posts/3739238203/</url>
    <content><![CDATA[<h1 id="MariaDB-MySQL下使用二进制日志恢复数据"><a href="#MariaDB-MySQL下使用二进制日志恢复数据" class="headerlink" title="MariaDB / MySQL下使用二进制日志恢复数据"></a>MariaDB / MySQL下使用二进制日志恢复数据</h1><h2 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h2><h3 id="备份分类"><a href="#备份分类" class="headerlink" title="备份分类"></a>备份分类</h3><p>按备份形式，数据库备份分为：</p>
<p>​    完全备份：备份完整数据集。不依赖其他备份，备份文件较大；</p>
<p>​    增量备份：只备份自上一次备份以来的新增部分。恢复数据时须按照备份的顺序依次恢复，每个增量备份文件都依赖其前期的备份，当之前的某个备份文件出错时会导致其后的备件不可用；</p>
<p>​    差异备份：只备份自上一次完全备份以来至当前的增量。恢复数据时先恢复完全备份，在此基础上再恢复差异备份。</p>
<h3 id="二进制日志介绍"><a href="#二进制日志介绍" class="headerlink" title="二进制日志介绍"></a>二进制日志介绍</h3><ol>
<li>二进制日志记录了对数据库详细的增、删、改操作过程（SQL语句），可以使用二进制日志来恢复数据。</li>
<li>二进制日志的启用需要依赖log_bin和sql_log_bin这两个系统变量。sql_log_bin用于临时启用或禁用二进制日志，不能在配置文件中定义；log_bin用于永久启用或禁用二进制日志，只能在配置文件中定义。这两个系统变量，只要有一个没有启用，则二进制日志就不会启用。</li>
<li>二进制日志文件应该单独存放，不与数据库文件存在同一磁盘。</li>
</ol>
<h3 id="启用二进制日志"><a href="#启用二进制日志" class="headerlink" title="启用二进制日志"></a>启用二进制日志</h3><p><strong>查看是启用了二进制日志：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mariadb root@localhost:hellodb&gt; SHOW VARIABLES LIKE '%log_bin';		-- 查看是启用了二进制日志</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| log_bin       | ON    |</span><br><span class="line">| sql_log_bin   | ON    |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br></pre></td></tr></table></figure>

<p>若没有启用，修改MariaDB的配置文件，使之启用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim mariadb.conf.d/50-server.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log_bin         = /mydata/logs/mysqld-binlog</span><br></pre></td></tr></table></figure>

<p>查看当前使用的二进制日志文件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mariadb root@localhost:hellodb&gt; SHOW MASTER STATUS;</span><br><span class="line">+<span class="comment">----------------------+----------+--------------+------------------+</span></span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+<span class="comment">----------------------+----------+--------------+------------------+</span></span><br><span class="line">| mysqld-binlog.000001 | 332      |              |                  |</span><br><span class="line">+<span class="comment">----------------------+----------+--------------+------------------+</span></span><br></pre></td></tr></table></figure>

<p><strong>MariaDB/MySQL数据库启用二进制日志文件，定期执行完全备份。当数据库出现问题时，先使用最近的完全备份进行恢复，再在二进制日志文件中找出自该完全备份之后至出现问题时的更新，并执行这些更新即可恢复数据至最近状态。此方法使用了完全备份 + 二进制日志的方式进行数据恢复。</strong></p>
<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p><strong>备份工具：mysqldump</strong></p>
<p>Dumping structure and contents of MySQL databases and tables.<br>Usage: mysqldump [OPTIONS] database [tables]<br>OR     mysqldump [OPTIONS] –databases DB1 [DB2 DB3…]<br>OR     mysqldump [OPTIONS] –all-databases<br>OR     mysqldump [OPTIONS] –system=[SYSTEMOPTIONS]]</p>
<p><strong>-A, –all-databases</strong>        Dump all the databases. This will be same as –databases with all databases selected.</p>
<p><strong>-B, –databases</strong>            Dump several databases. Note the difference in usage; in this case no tables are given. All name arguments are regarded as database names. ‘USE db_name;’ will be included in the output.</p>
<p><strong>–master-data[=#]</strong>      This causes the binary log position and filename to be appended to the output. If equal to 1, will print it as a CHANGE MASTER command; if equal to 2, that command will be prefixed with a comment symbol. </p>
<ol>
<li>备份数据库，并在备份脚本中记录二进制日志的位置:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mysqldump -uroot -pmydbpass -h172.17.0.2 -B hellodb --master-data=2 &gt; hellodb_bak.sql</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> grep -i master_log hellodb_bak.sql </span></span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE='mysqld-binlog.000001', MASTER_LOG_POS=332;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>更新数据库内容：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mariadb root@localhost:hellodb&gt; DELETE FROM test WHERE id = (SELECT MAX(id) FROM test);</span><br><span class="line">mariadb root@localhost:hellodb&gt; INSERT INTO test (id, firstname, lastname) VALUES (3,'a', 'a1'), (4, 'b', 'b1');</span><br><span class="line">mariadb root@localhost:hellodb&gt; SHOW MASTER LOGS;		-- 查看二进制日志文件位置。由此可见，位置已经从之前的332偏移至871</span><br><span class="line">+<span class="comment">----------------------+-----------+</span></span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+<span class="comment">----------------------+-----------+</span></span><br><span class="line">| mysqld-binlog.000001 | 871       |</span><br><span class="line">+<span class="comment">----------------------+-----------+</span></span><br></pre></td></tr></table></figure>

<h2 id="模拟数据库故障"><a href="#模拟数据库故障" class="headerlink" title="模拟数据库故障"></a>模拟数据库故障</h2><p>删除数据库：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mariadb root@localhost:hellodb&gt; DROP DATABASE hellodb;</span><br><span class="line">mariadb root@localhost:(none)&gt; SHOW MASTER LOGS;	-- 再次查看二进制日志位置</span><br><span class="line">+<span class="comment">----------------------+-----------+</span></span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+<span class="comment">----------------------+-----------+</span></span><br><span class="line">| mysqld-binlog.000001 | 1004      |</span><br><span class="line">+<span class="comment">----------------------+-----------+</span></span><br></pre></td></tr></table></figure>

<h2 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h2><ol>
<li>停用二进制日志（若生产中，此时要维护数据库，应立即断开网络连接，使数据库处于脱机状态）：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mariadb root@localhost:(none)&gt; SET sql_log_bin=OFF;</span><br><span class="line">mariadb root@localhost:(none)&gt; SHOW VARIABLES LIKE '%log_bin';</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| log_bin       | ON    |</span><br><span class="line">| sql_log_bin   | OFF   |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用之前的备份脚本导入数据：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [hellodb]&gt; SOURCE ~/Projects/docker_volumes/mydata/logs/backup/hellodb_bak.sql</span><br><span class="line"><span class="comment">#注意：此时只能在登录到RDBMS上，使用SOURCE命令导入，不能在文件系统上执行导入（$ mysql -uroot -p &lt; hellodb_bak.sql），否则导入过程会记录到二进制日志</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看备份数据时，使用的二进制日志文件及位置：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> grep MASTER_LOG_POS hellodb_bak.sql </span></span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE='mysqld-binlog.000001', MASTER_LOG_POS=332;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>找出问题SQL语句的位置：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mysqlbinlog --start-position=332 mysqld-binlog.000001 | grep -B 15 -i <span class="string">'drop database hellodb'</span></span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 871</span></span><br><span class="line"><span class="meta">#</span><span class="bash">210718 16:19:31 server id 1  end_log_pos 913 CRC32 0xd56b0a34  GTID 0-1-3 ddl</span></span><br><span class="line">/*!100001 SET @@session.gtid_seq_no=3*//*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 913		<span class="comment"># DROP DATABASE hellodb 出现在二进制日志的位置</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">210718 16:19:31 server id 1  end_log_pos 1004 CRC32 0x05ba3301         Query   thread_id=33    exec_time=0     error_code=0</span></span><br><span class="line">SET TIMESTAMP=1626625171/*!*/;</span><br><span class="line">SET @@session.pseudo_thread_id=33/*!*/;</span><br><span class="line">SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1, @@session.check_constraint_checks=1, @@session.sql_if_exists=0/*!*/;</span><br><span class="line">SET @@session.sql_mode=1411383296/*!*/;</span><br><span class="line">SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;</span><br><span class="line">/*!\C utf8mb4 *//*!*/;</span><br><span class="line">SET @@session.character_set_client=45,@@session.collation_connection=45,@@session.collation_server=45/*!*/;</span><br><span class="line">SET @@session.lc_time_names=0/*!*/;</span><br><span class="line">SET @@session.collation_database=DEFAULT/*!*/;</span><br><span class="line">DROP DATABASE hellodb</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>使用mysqlbinlog，从二进制日志文件中截取要恢复的SQL语句至脚本文件中（此例中为332至913）：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mysqlbinlog --start-position=332 --stop-position=913 mysqld-binlog.000001 &gt; incr.sql</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在数据库数据中执行截取的二进制文件 ：</li>
</ol>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">MariaDB [hellodb]&gt; source ~/Projects/docker_volumes/mydata/logs/backup/incr.sql</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>验证数据：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [hellodb]&gt; SELECT * FROM test;</span><br><span class="line">+<span class="comment">----+-----------+----------+-------------+</span></span><br><span class="line">| id | firstname | lastname | phone       |</span><br><span class="line">+<span class="comment">----+-----------+----------+-------------+</span></span><br><span class="line">|  3 | a         | a1       | NULL        |</span><br><span class="line">|  4 | b         | b1       | NULL        |</span><br><span class="line">|  2 | Bai       | Na       | 15810697243 |</span><br><span class="line">|  1 | Li        | Yinkai   | 15810697243 |</span><br><span class="line">+<span class="comment">----+-----------+----------+-------------+</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>恢复记录二进制日志文件 ：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [hellodb]&gt; SET sql_log_bin=ON;</span><br><span class="line">MariaDB [hellodb]&gt; SHOW VARIABLES LIKE '%log_bin';  </span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| log_bin       | ON    |</span><br><span class="line">| sql_log_bin   | ON    |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>技术</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MariaDB</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 下连接蓝牙设备</title>
    <url>/posts/1977779135/</url>
    <content><![CDATA[<h1 id="使用蓝牙过程"><a href="#使用蓝牙过程" class="headerlink" title="使用蓝牙过程"></a>使用蓝牙过程</h1><ol>
<li>启动蓝牙；</li>
<li>扫描可用的蓝牙设备；</li>
<li>连接蓝牙设备（经过测试，在使用蓝牙鼠标不需要连接，扫描后直接与之配对即可）；</li>
<li>配对蓝牙设备。</li>
</ol>
<h1 id="蓝牙管理工具：bluetoothctl"><a href="#蓝牙管理工具：bluetoothctl" class="headerlink" title="蓝牙管理工具：bluetoothctl"></a>蓝牙管理工具：bluetoothctl</h1><p><strong><em>此处以连接蓝牙鼠标为例说明：</em></strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo -i</span><br><span class="line"><span class="comment"># 启动蓝牙管理工具</span></span><br><span class="line"><span class="comment"># bluetoothctl</span></span><br><span class="line">[NEW] Controller 4C:34:88:94:D7:C4 yinkai-ThinkPad-X250 [default]</span><br><span class="line">[NEW] Device D0:16:B4:4D:47:9D Yinkai-Honor10</span><br><span class="line"></span><br><span class="line">[bluetooth]<span class="comment"># help</span></span><br><span class="line">Available commands:</span><br><span class="line">  list                       List available controllers</span><br><span class="line">  show [ctrl]                Controller information</span><br><span class="line">  select &lt;ctrl&gt;              Select default controller</span><br><span class="line">  devices                    List available devices</span><br><span class="line">  paired-devices             List paired devices</span><br><span class="line">  power &lt;on/off&gt;             Set controller power</span><br><span class="line">  pairable &lt;on/off&gt;          Set controller pairable mode</span><br><span class="line">  discoverable &lt;on/off&gt;      Set controller discoverable mode</span><br><span class="line">  agent &lt;on/off/capability&gt;  Enable/<span class="built_in">disable</span> agent with given capability</span><br><span class="line">  default-agent              Set agent as the default one</span><br><span class="line">  <span class="built_in">set</span>-scan-filter-uuids [uuid1 uuid2 ...] Set scan filter uuids</span><br><span class="line">  <span class="built_in">set</span>-scan-filter-rssi [rssi] Set scan filter rssi, and clears pathloss</span><br><span class="line">  <span class="built_in">set</span>-scan-filter-pathloss [pathloss] Set scan filter pathloss, and clears rssi</span><br><span class="line">  <span class="built_in">set</span>-scan-filter-transport [transport] Set scan filter transport</span><br><span class="line">  <span class="built_in">set</span>-scan-filter-clear      Clears discovery filter.</span><br><span class="line">  scan &lt;on/off&gt;              Scan <span class="keyword">for</span> devices</span><br><span class="line">  info [dev]                 Device information</span><br><span class="line">  pair [dev]                 Pair with device</span><br><span class="line">  trust [dev]                Trust device</span><br><span class="line">  untrust [dev]              Untrust device</span><br><span class="line">  block [dev]                Block device</span><br><span class="line">  unblock [dev]              Unblock device</span><br><span class="line">  remove &lt;dev&gt;               Remove device</span><br><span class="line">  connect &lt;dev&gt;              Connect device</span><br><span class="line">  disconnect [dev]           Disconnect device</span><br><span class="line">  list-attributes [dev]      List attributes</span><br><span class="line">  select-attribute &lt;attribute&gt; Select attribute</span><br><span class="line">  attribute-info [attribute] Select attribute</span><br><span class="line">  <span class="built_in">read</span>                       Read attribute value</span><br><span class="line">  write &lt;data=[xx xx ...]&gt;   Write attribute value</span><br><span class="line">  notify &lt;on/off&gt;            Notify attribute value</span><br><span class="line">  register-profile &lt;UUID ...&gt; Register profile to connect</span><br><span class="line">  unregister-profile         Unregister profile</span><br><span class="line">  version                    Display version</span><br><span class="line">  quit                       Quit program</span><br><span class="line"></span><br><span class="line">[bluetooth]<span class="comment"># show</span></span><br><span class="line">Controller 4C:34:88:94:D7:C4</span><br><span class="line">	Name: yinkai-ThinkPad-X250</span><br><span class="line">	Alias: yinkai-ThinkPad-X250</span><br><span class="line">	Class: 0x000000</span><br><span class="line">	Powered: yes</span><br><span class="line">	Discoverable: yes</span><br><span class="line">	Pairable: yes</span><br><span class="line">	UUID: Headset AG                (00001112-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Generic Attribute Profile (00001801-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: A/V Remote Control        (0000110e-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: OBEX File Transfer        (00001106-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Generic Access Profile    (00001800-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: OBEX Object Push          (00001105-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: PnP Information           (00001200-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: A/V Remote Control Target (0000110c-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: IrMC Sync                 (00001104-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Audio Sink                (0000110b-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Audio Source              (0000110a-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Vendor specific           (00005005-0000-1000-8000-0002ee000001)</span><br><span class="line">	UUID: Message Notification Se.. (00001133-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Phonebook Access Server   (0000112f-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	UUID: Message Access Server     (00001132-0000-1000-8000-00805f9b34fb)</span><br><span class="line">	Modalias: usb:v1D6Bp0246d0525</span><br><span class="line">	Discovering: no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看可用的蓝牙设备</span></span><br><span class="line">[bluetooth]<span class="comment"># devices     </span></span><br><span class="line">Device D0:16:B4:4D:47:9D Yinkai-Honor10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启蓝牙设备</span></span><br><span class="line">[bluetooth]<span class="comment"># power off     </span></span><br><span class="line">Changing power off succeeded</span><br><span class="line">[CHG] Controller 4C:34:88:94:D7:C4 Powered: no</span><br><span class="line">[CHG] Controller 4C:34:88:94:D7:C4 Discovering: no</span><br><span class="line">[bluetooth]<span class="comment"># power on</span></span><br><span class="line">Changing power on succeeded</span><br><span class="line">[CHG] Controller 4C:34:88:94:D7:C4 Powered: yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扫描可用的蓝牙设备</span></span><br><span class="line">[bluetooth]<span class="comment"># scan on</span></span><br><span class="line">Discovery started</span><br><span class="line">[CHG] Controller 4C:34:88:94:D7:C4 Discovering: yes</span><br><span class="line">[NEW] Device CF:D0:F4:9B:8D:F7 M720 Triathlon</span><br><span class="line">[NEW] Device 22:22:58:10:EB:91 M8S PRO L</span><br><span class="line">[NEW] Device C8:28:32:0D:AB:5E MI BT18 BLE</span><br><span class="line">[CHG] Device CF:D0:F4:9B:8D:F7 RSSI: -59</span><br><span class="line">[CHG] Device CF:D0:F4:9B:8D:F7 RSSI: -48</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止扫描</span></span><br><span class="line">[bluetooth]<span class="comment"># scan off</span></span><br><span class="line">[CHG] Device C8:28:32:0D:AB:5E RSSI is nil</span><br><span class="line">[CHG] Device 22:22:58:10:EB:91 RSSI is nil</span><br><span class="line">[CHG] Device CF:D0:F4:9B:8D:F7 RSSI is nil</span><br><span class="line">Discovery stopped</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次查看可用的蓝牙设备</span></span><br><span class="line">[bluetooth]<span class="comment"># devices </span></span><br><span class="line">Device D0:16:B4:4D:47:9D Yinkai-Honor10</span><br><span class="line">Device CF:D0:F4:9B:8D:F7 M720 Triathlon</span><br><span class="line">Device 22:22:58:10:EB:91 M8S PRO L</span><br><span class="line">Device C8:28:32:0D:AB:5E MI BT18 BLE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配对蓝牙设备（设备地址）</span></span><br><span class="line">[bluetooth]<span class="comment"># pair CF:D0:F4:9B:8D:F7</span></span><br><span class="line">Attempting to pair with CF:D0:F4:9B:8D:F7</span><br><span class="line">[CHG] Device CF:D0:F4:9B:8D:F7 Connected: yes</span><br><span class="line">[CHG] Device CF:D0:F4:9B:8D:F7 Paired: yes</span><br><span class="line">Pairing successful</span><br><span class="line">[CHG] Device CF:D0:F4:9B:8D:F7 Modalias: usb:v046DpB015d0009</span><br><span class="line">[DEL] Device 22:22:58:10:EB:91 M8S PRO L</span><br><span class="line">[DEL] Device C8:28:32:0D:AB:5E MI BT18 BLE</span><br><span class="line">[M720 Triathlon]<span class="comment"># exit</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>bluetoothctl</tag>
        <tag>蓝牙</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown语法介绍</title>
    <url>/posts/2392901311/</url>
    <content><![CDATA[<h1 id="一、标题"><a href="#一、标题" class="headerlink" title="一、标题"></a>一、标题</h1><h1 id="这是一级标题"><a href="#这是一级标题" class="headerlink" title="这是一级标题"></a>这是一级标题</h1><h2 id="这是二级标题"><a href="#这是二级标题" class="headerlink" title="这是二级标题"></a>这是二级标题</h2><h3 id="这是三级标题"><a href="#这是三级标题" class="headerlink" title="这是三级标题"></a>这是三级标题</h3><h4 id="这是四级标题"><a href="#这是四级标题" class="headerlink" title="这是四级标题"></a>这是四级标题</h4><h5 id="这是五级标题"><a href="#这是五级标题" class="headerlink" title="这是五级标题"></a>这是五级标题</h5><h6 id="这是六级标题"><a href="#这是六级标题" class="headerlink" title="这是六级标题"></a>这是六级标题</h6><h1 id="二、字体"><a href="#二、字体" class="headerlink" title="二、字体"></a>二、字体</h1><p><strong>这是加粗的文字</strong><br><br><em>这是倾斜的文字</em>`<br><br><strong><em>这是斜体加粗的文字</em></strong><br><br><del>这是加删除线的文字</del></p>
<h2 id="字体颜色"><a href="#字体颜色" class="headerlink" title="字体颜色"></a>字体颜色</h2><p>浅红色文字：<font color="#dd0000">浅红色文字：</font><br /><br>深红色文字：<font color="#660000">深红色文字</font><br /><br>浅绿色文字：<font color="#00dd00">浅绿色文字</font><br /><br>深绿色文字：<font color="#006600">深绿色文字</font><br /><br>浅蓝色文字：<font color="#0000dd">浅蓝色文字</font><br /><br>深蓝色文字：<font color="#000066">深蓝色文字</font><br /><br>浅黄色文字：<font color="#dddd00">浅黄色文字</font><br /><br>深黄色文字：<font color="#666600">深黄色文字</font><br /><br>浅青色文字：<font color="#00dddd">浅青色文字</font><br /><br>深青色文字：<font color="#006666">深青色文字</font><br /><br>浅紫色文字：<font color="#dd00dd">浅紫色文字</font><br /><br>深紫色文字：<font color="#660066">深紫色文字</font><br /> </p>
<h2 id="大小"><a href="#大小" class="headerlink" title="大小"></a>大小</h2><p>size为1：<font size="1">size为1</font><br /><br>size为2：<font size="2">size为2</font><br /><br>size为3：<font size="3">size为3</font><br /><br>size为4：<font size="4">size为4</font><br /><br>size为10：<font size="10">size为10</font><br /> </p>
<h1 id="三、分割线"><a href="#三、分割线" class="headerlink" title="三、分割线"></a>三、分割线</h1><hr>
<hr>
<h1 id="四、引用"><a href="#四、引用" class="headerlink" title="四、引用"></a>四、引用</h1><blockquote>
<p>这是引用的内容</p>
<blockquote>
<p>这是引用的内容</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>这是引用的内容</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h1 id="五、图片"><a href="#五、图片" class="headerlink" title="五、图片"></a>五、图片</h1><h1 id="六、代码"><a href="#六、代码" class="headerlink" title="六、代码"></a>六、代码</h1><h2 id="单行代码"><a href="#单行代码" class="headerlink" title="单行代码"></a>单行代码</h2><h2 id="多行代码"><a href="#多行代码" class="headerlink" title="多行代码"></a>多行代码</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print(&#39;Hello World&#39;)</span><br></pre></td></tr></table></figure>



<h2 id="语法说明"><a href="#语法说明" class="headerlink" title="语法说明"></a>语法说明</h2><p>插入程序代码的方式有两种：使用反引号 `（~ 键）、使用缩进（Tab）。</p>
<ul>
<li>插入行内代码，即插入一个单词或者一句代码的情况，使用 <code>code</code> 这样的形式插入。</li>
<li>插入多行代码，分别使用三个反引号（```）包裹多行代码。或者使用缩进。</li>
</ul>
<h3 id="行内代码"><a href="#行内代码" class="headerlink" title="行内代码"></a>行内代码</h3><p>在一般的段落文字中，可以使用反引号来标记或插入代码区段。<br><br>示例：<br><br>C语言里的函数 <code>scanf()</code> 怎么使用？<br></p>
<p><code>create database DATABASE_NAME;</code></p>
<h3 id="多行代码-1"><a href="#多行代码-1" class="headerlink" title="多行代码"></a>多行代码</h3><p>在需要高亮的代码块的前一行及后一行使用三个反引号 ```（~ 键），同时第一行反引号后面，输入码块所使用的语言，实现代码高亮。<br>比如高亮 python3 代码块：</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintHello</span>:</span></span><br><span class="line">    print(<span class="string">"Hello, World!"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="缩进式插入多行代码"><a href="#缩进式插入多行代码" class="headerlink" title="缩进式插入多行代码"></a>缩进式插入多行代码</h3><p>注意：</p>
<ul>
<li>缩进式插入前方必须有空行；</li>
<li>缩进 4 个空格或是 1 个制表符；</li>
<li>一个代码区块会一直持续到没有缩进的那一行（或是文件结尾）。<br>代码：</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;stdio.h&gt;`</span></span></span><br><span class="line">int main(void)`</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello world\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="七、超链接"><a href="#七、超链接" class="headerlink" title="七、超链接"></a>七、超链接</h1><h1 id="八、表格"><a href="#八、表格" class="headerlink" title="八、表格"></a>八、表格</h1><h1 id="九、列表："><a href="#九、列表：" class="headerlink" title="九、列表："></a>九、列表：</h1><h2 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h2><p>语法：无序列表用 - + * 任何一种都可以</p>
<ul>
<li>列表内容</li>
</ul>
<ul>
<li>列表内容</li>
</ul>
<ul>
<li>列表内容</li>
</ul>
<p>注意：- + * 跟内容之间都要有一个空格</p>
<h2 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h2><p>语法：<br>    数字加点</p>
<ol>
<li>列表内容</li>
<li>列表内容</li>
<li>列表内容</li>
</ol>
<p>注意：序号跟内容之间要有空格</p>
<h2 id="列表嵌套"><a href="#列表嵌套" class="headerlink" title="列表嵌套"></a>列表嵌套</h2><p>上一级和下一级之间敲三个空格即可：</p>
<ul>
<li>一级无序列表内容<ul>
<li>二级无序列表内容<ul>
<li>三级无序列表内容</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="十、流程图"><a href="#十、流程图" class="headerlink" title="十、流程图"></a>十、流程图</h1>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello Hexo</title>
    <url>/posts/2708806665/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>使用SSL/TSL证书加密通讯过程</title>
    <url>/posts/3697389350/</url>
    <content><![CDATA[<p><strong><font color="#dd0000" size="5">本文以Bob和Alice安全通讯为例说明</font></strong></p>
<p><font color="#dd0000" size="5">Bob&lt;———&gt;Alice  </font></p>
<h1 id="1-验证证书"><a href="#1-验证证书" class="headerlink" title="1. 验证证书"></a>1. 验证证书</h1><p><em>Bob要和Alice安全通信首先要取得对方的公钥，即对方的证书，并验证证书的合法性。验证过程和内容如下：</em></p>
<p>1）、用CA的公钥（双方已知）解密对方证书中CA的签名；能解密说明证书来原可靠；</p>
<p>2）、用证书中标记的“签名算法”来计算证书的相关信息，并将散列计算的结果与证书“发行者签名”解密的结果（证书特征码）进行比较，如果一致说明证书完整性可靠；</p>
<p>3）、检查证书的有效期限是否在合法范围内，防止证书过期；</p>
<p>4）、验证证书的 “主体名称” 和预通信的人是否对应；</p>
<p>5）、检查证书是否被吊销；</p>
<p><em>以上验证成功则说明对方证书可靠，并信任该证书。</em></p>
<p><strong>取得对方证书（即公钥）后进行如下操作：</strong></p>
<h1 id="2-加密"><a href="#2-加密" class="headerlink" title="2. 加密"></a>2. 加密</h1><p>1)、Bob对明文数据进行散列计算，提取出数据指纹（特征码，也叫信息摘要）；</p>
<p>2)、Bob使用自己的私钥对该数据指纹进行加密，生成数字签名，并将该数字签名附加在明文数据之后；</p>
<p>3)、Bob使用一个一次性的对称加密算法密钥对明文和数字签名进行加密，生成密文；</p>
<p>4)、Bob再使用Alice的公钥对对称加密算法的密钥进行加密，生成数字信封；</p>
<p>5)、Bob将密文和数字信封打包发送给Alice；</p>
<h1 id="3-解密"><a href="#3-解密" class="headerlink" title="3. 解密"></a>3. 解密</h1><p>1)、Alice收到数据（密文+数字信封）后，使用自己的私钥解密数字信封，得到对称加密算法的密钥；</p>
<p>2)、使用对称加密密钥解密密文，得到明文数据和数字签名。保证了数据的私密性；</p>
<p>3)、使用Bob的公钥解密数字签名，得到明文的数据指纹（特征码）。如果能解出，说明数据为Bob发送，保证了数据的不可否认性；</p>
<p>4)、Alice使用同样的散列算法对明文计算得出数据指纹（特征码），并与Bob计算的数据指纹进行比对，如果一致，说明数据没有被篡改。保证了数据的完整性.  </p>
<p><img src="https://yinkai-blogs.oss-cn-beijing.aliyuncs.com/images/TLS.png" alt="TLS"></p>
<!-- <center>  -->
<p><em>使用SSL/TSL证书加密通讯示意图</em> </p>
<!-- </center> -->]]></content>
      <categories>
        <category>技术</category>
        <category>安全</category>
      </categories>
      <tags>
        <tag>SSL/TLS</tag>
        <tag>加密</tag>
        <tag>安全</tag>
      </tags>
  </entry>
  <entry>
    <title>在Linux下创建并使用私有CA为客户端颁发证书</title>
    <url>/posts/2939447081/</url>
    <content><![CDATA[<p>应用服务器在使用证书前需向RA（证书注册机构）提出申请，RA对申请人信息进行核验，核验成功后由CA进行签署并生成证书。为了保证CA签署的证书可信，CA在签署客户证书前需要先生成自签证书，客户端会使用CA的证书来验证CA所签署的证书。</p>
<ul>
<li><h1 id="证书颁发过程"><a href="#证书颁发过程" class="headerlink" title="证书颁发过程"></a>证书颁发过程</h1><ol>
<li><p>申请人向RA递交证书申请；</p>
</li>
<li><p>RA会要求申请人递交自己的公钥和其它相关信息；</p>
</li>
<li><p>RA核验该申请方的真实信息；</p>
</li>
<li><p>核验通过后，RA会将请求转交给CA进行签署。由CA对这些信息进行散列，并用自己的私钥对散列结果进行加密，生成数字签名；</p>
</li>
<li><p>将申请方的信息和数字签名一起封装到证书内，颁发给申请人；</p>
</li>
</ol>
</li>
<li><h1 id="证书申请及签署实例"><a href="#证书申请及签署实例" class="headerlink" title="证书申请及签署实例"></a>证书申请及签署实例</h1><p>  <em>使用自建CA签署证书时CA和RA可合并</em></p>
<ul>
<li><h2 id="工具：OpenSSL"><a href="#工具：OpenSSL" class="headerlink" title="工具：OpenSSL"></a>工具：OpenSSL</h2></li>
<li><h2 id="操作过程"><a href="#操作过程" class="headerlink" title="操作过程:"></a>操作过程:</h2><ol>
<li><p>构建私有CA：</p>
<p>(1) 检查安装openssl;  </p>
<p>(2) 根据openssl的配置文件（/etc/pki/tls/openssl.cnf）创建所需要的文件；</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># touch /etc/pki/CA/index.txt          #创建证书索引文件</span></span><br><span class="line"><span class="comment"># echo 01 &gt; /etc/pki/CA/serial        #设置证书的序列号</span></span><br></pre></td></tr></table></figure>

<p>(3) 自签证书：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> (<span class="built_in">umask</span> 077; openssl genrsa -out /etc/pki/CA/private/cakey.pem 2048)        <span class="comment">#生成CA的私钥</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -days 3650 -out /etc/pki/CA/cacert.pem            <span class="comment">#生成自签证书签署请求，只有在生成自签证书时使用-x509选项</span></span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Beijing</span><br><span class="line">Locality Name (eg, city) [Default City]:Beijing</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:Yinkai</span><br><span class="line">Organizational Unit Name (eg, section) []:Ops</span><br><span class="line">Common Name (eg, your name or your server's hostname) []:ca.yinkai.site   </span><br><span class="line">Email Address []:caadmin@yinkai.site</span><br></pre></td></tr></table></figure>
</li>
<li><p>为客户端签发证书：</p>
<p> (1) 客户端提交证书签署请求：</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># (umask 077; openssl genrsa -out /etc/httpd/ssl/httpd.key 2048)                #客户端生成私钥</span></span><br><span class="line"><span class="comment"># openssl req -new -key /etc/httpd/ssl/httpd.key -days 365 -out /etc/httpd/ssl/httpd.csr            #客户端生成证书签署请求文件 </span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Beijing</span><br><span class="line">Locality Name (eg, city) [Default City]:Beijing</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:Yinkai</span><br><span class="line">Organizational Unit Name (eg, section) []:Tech</span><br><span class="line">Common Name (eg, your name or your server<span class="string">'s hostname) []:www.yinkai.site        #此处的公共名需与实际使用的服务器访问名称一致</span></span><br><span class="line"><span class="string">Email Address []:caadmin@yinkai.site</span></span><br><span class="line"><span class="string">Please enter the following '</span>extra<span class="string">' attributes</span></span><br><span class="line"><span class="string">to be sent with your certificate request</span></span><br><span class="line"><span class="string">A challenge password []:</span></span><br><span class="line"><span class="string">An optional company name []:</span></span><br></pre></td></tr></table></figure>

<p> (2) 将证书签署请求发给RA（此处RA与CA一致）:</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> scp /etc/httpd/ssl/httpd.csr root@192.168.1.71:/tmp</span></span><br></pre></td></tr></table></figure>

<p> (3) CA签署请求：</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># openssl ca -in /tmp/httpd.csr -days 365 -out /etc/pki/CA/certs/httpd.crt</span></span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Oct 29 06:53:10 2016 GMT</span><br><span class="line">            Not After : Oct 29 06:53:10 2017 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = Beijing</span><br><span class="line">            organizationName          = Yinkai</span><br><span class="line">            organizationalUnitName    = Tech</span><br><span class="line">            commonName                = www.yinkai.site</span><br><span class="line">            emailAddress              = caadmin@yinkai.site</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment: </span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                4B:08:90:15:E3:FE:E2:44:AF:BD:C2:79:F9:13:4A:B8:FB:70:BF:4A</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:32:43:7A:30:8C:2E:22:87:85:63:04:F1:37:D4:8C:4D:3B:41:10:B8</span><br><span class="line">Certificate is to be certified until Oct 29 06:53:10 2017 GMT (365 days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line">1 out of 1 certificate requests certified, commit? [y/n]y</span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br></pre></td></tr></table></figure>
<p> (4) 将证书发送给请求客户端：</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># scp /etc/pki/CA/certs/httpd.crt root@192.168.1.61:/etc/httpd/ssl/</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
        <category>安全</category>
      </categories>
      <tags>
        <tag>SSL/TLS</tag>
        <tag>安全</tag>
        <tag>CA</tag>
        <tag>证书</tag>
      </tags>
  </entry>
  <entry>
    <title>Web Service</title>
    <url>/posts/895680827/</url>
    <content><![CDATA[<p><img src="https://yinkai-blogs.oss-cn-beijing.aliyuncs.com/images/Web-Service.png" alt="Web-Service"></p>
]]></content>
      <categories>
        <category>技术</category>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Socket</tag>
        <tag>Web</tag>
        <tag>URI</tag>
        <tag>URL</tag>
      </tags>
  </entry>
</search>
